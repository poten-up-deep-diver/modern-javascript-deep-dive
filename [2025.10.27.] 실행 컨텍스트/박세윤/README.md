# [JS] 함수와 블록의 실행 컨텍스트 차이

## ✋🏻 들어가기전…

「모던 자바스크립트 Deep Dive」23장을 읽고, 실행 컨텍스트에 대해 알아볼 수 있었다. 그런데 23장의 마지막 부분에서, 블록 스코프의 경우 실행 컨텍스트가 새롭게 할당되지 않고, 실행 컨텍스트 스택에 쌓이지 않는 부분에 대해서 의문이 생겨, 개념을 정리해보고 의문점에 대해 조금 더 알아보려고 한다.

## 🤔 실행 컨텍스트란?

> 실행 컨텍스트란 **소스코드를 실행하는데 필요한 환경**을 제공하고, 코드의 **실행 결과를 실제로 관리**하는 영역이다. 좀 더 구체적으로 말하면, 식별자를 등록하고 관리하는 **스코프**와 **코드 실행 순서 관리**를 구현한 내부 메커니즘으로, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.

위의 설명은, 책에 나와있는 설명이다.

한 마디로 쉽게 정리하자면, **스코프와 실행 순서 관리자**라고 할 수 있다.

**스코프의 경우 렉시컬 환경으로 관리**하고,

**실행 순서는 실행 컨텍스트 스택으로 관리**한다.

## 🤔 렉시컬 환경이란?

> 렉시컬 환경은 **식별자와, 식별자에 바인딩된 값**, 그리고 **상위 스코프에 대한 참조를 기록**하는 자료구조로, 실행 컨텍스트를 구성하는 컴포넌트이다.

렉시컬 환경이라는 단어가 어려울 수 있지만, 한 마디로 **식별자가 무슨 값**인지, 내 **상위 스코프는 어디인지 적어놓은 표**라고 할 수 있다.

## 🤔 실행 컨텍스트 스택?

> 실행 컨텍스트 스택이란 코드의 **실행 순서를 관리**하는 자료구조로, **스택 구조**로 되어있다.

※ 스택 구조: LIFO(Last In First Out) 구조의 자료구조로, 한쪽 끝에서 자료를 넣고 빼는 구조이다. 예시로는 웹 브라우저의 뒤로 가기 버튼이 있다.

전역 실행 컨텍스트가 스택의 가장 아래에 위치하며,

함수를 호출할 때 새롭게 실행 컨텍스트가 만들어져 스택에 쌓이게 된다.

이 후, 함수가 종료되면 해당 함수의 실행 컨텍스트가 스택에서 제거된다.

위의 설명처럼, **함수가 호출될 때 새로운 실행 컨텍스트가 생성**된다고 했다. 그 말은 즉, **블록 스코프가 실행될 때는 실행 컨텍스트가 생성되지 않는다**는 의미이다. 그렇다면 왜 블록 스코프는 새롭게 실행 컨텍스트를 만들지 않을까?

## 🤔 함수 스코프와 블록 스코프

우선, 함수 스코프와 블록 스코프가 실행될 때 실행 컨텍스트 및 렉시컬 환경이 어떻게 변화하는지 알아보자.

### 함수 스코프

```jsx
var a = 10;
function test() {
  var a = 5;
  console.log(a);
}
test();
```

위의 예시의 실행 순서를 써보자면,

1. 전역 실행 컨텍스트가 생성되고, 실행 컨텍스트 스택에 쌓인다.
2. 전역 실행 컨텍스트의 렉시컬 환경에 `a`와 `test`가 등록된다.
3. 전역 코드 실행이 시작된다.
4. `test()`가 호출될 때, 새로운 `test` 실행 컨텍스트가 생성되고, 실행 컨텍스트에 쌓인다.
5. `test` 실행 컨텍스트의 렉시컬 환경에 `a`가 등록된다.
6. `test` 함수 코드가 실행된다.
7. `test` 함수가 종료되면, 해당 함수의 실행 컨텍스트가 스택에서 제거된다.
8. 전역 코드가 종료되면 전역 실행 컨텍스트가 스택에서 제거된다.

### 블록 스코프

```jsx
let a = 10;
if (a === 10) {
  let a = 5;
  console.log(a);
}
```

이번엔 블록 스코프의 실행 순서를 써보면,

1. 전역 실행 컨텍스트가 생성되고, 실행 컨텍스트 스택에 쌓인다.
2. 전역 실행 컨텍스트의 렉시컬 환경에 `a`가 등록된다.
3. 전역 코드 실행이 시작된다.
4. `if`문 안의 조건문을 확인하고, 참이면 블록 레벨 스코프(렉시컬 환경)를 생성한다.
5. 전역 실행 컨텍스트가 가리키는 렉시컬 환경 참조를 해당 렉시컬 환경으로 교체한다.
6. `if`문 블록이 실행된다.
7. `if`문 블록이 종료되면 전역 실행 컨텍스트가 가리키는 렉시컬 환경 참조를 전역 렉시컬 환경으로 되돌린다.
8. 전역 코드가 종료되면 전역 실행 컨텍스트가 스택에서 제거된다.

위와 같이, 함수 스코프와 블록 스코프의 실행에서는 자체적인 실행 컨텍스트 생성 여부에서 차이가 있다.

그렇다면 도대체 왜 그럴까?

## 블록 스코프가 실행 컨텍스트를 가지지 않는 이유

블록 스코프는 자체적인 렉시컬 환경을 가지지만, 실행 컨텍스트는 가지지 않는다. 그 이유는 이미 앞의 설명으로도 충분히 이해할 수 있다.

앞서서, 실행 컨텍스트는 렉시컬 환경으로 스코프를 관리하고, 실행 컨텍스트 스택으로 실행 순서를 관리한다고 했었다.

따라서 블록 스코프가 실행 컨텍스트를 가지지 않으며 스택으로 관리되지 않으므로 실행 순서를 관리할 필요가 없다는 결론이 나온다.

생각해보면 정말 단순한 결론이다.

함수의 경우, 호출 시점에 따라서 **순차적인 코드의 흐름을 중단**하고 실행되어야 한다.

하지만 블록 스코프는 **상위 실행 컨텍스트의 실행 흐름에 포함**되어 있기 때문에 독자적인 스코프만 생성하고 흐름대로 실행만 하면 되는 것이다.

## 🧑🏻‍⚖️ 결론

1. 실행 컨텍스트란 스코프와 코드 실행 순서의 관리자다.
2. 함수 호출은 코드 실행 흐름의 새로운 단위이므로 실행 컨텍스트가 필요하다.
3. 블록 진입은 기존 코드 실행 흐름 내에서 변수 범위를 한정하기 위한 렉시컬 환경만 필요하다.
